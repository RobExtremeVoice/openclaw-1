---
title: "Whatsapp(WhatsApp ç¶²é é »é“)"
summary: "WhatsAppï¼ˆç¶²é é »é“ï¼‰æ•´åˆï¼šç™»å…¥ã€æ”¶ä»¶åŒ£ã€å›è¦†ã€åª’é«”å’Œæ“ä½œ"
read_when:
  - è™•ç† WhatsApp/ç¶²é é »é“è¡Œç‚ºæˆ–æ”¶ä»¶åŒ£è·¯ç”±
---
# WhatsAppï¼ˆç¶²é é »é“ï¼‰


ç‹€æ…‹ï¼šåƒ…æ”¯æ´é€é Baileys çš„ WhatsApp Webã€‚Gateway æ“æœ‰æœƒè©±ã€‚

## å¿«é€Ÿè¨­å®šï¼ˆåˆå­¸è€…ï¼‰
1) å¦‚æœå¯èƒ½ï¼Œä½¿ç”¨**ç¨ç«‹é›»è©±è™Ÿç¢¼**ï¼ˆå»ºè­°ï¼‰ã€‚
2) åœ¨ `~/.openclaw/openclaw.json` ä¸­è¨­å®š WhatsAppã€‚
3) åŸ·è¡Œ `openclaw channels login` æƒæ QR ç¢¼ï¼ˆå·²é€£çµè£ç½®ï¼‰ã€‚
4) å•Ÿå‹• Gatewayã€‚

æœ€å°è¨­å®šï¼š
```json5
{
  channels: {
    whatsapp: {
      dmPolicy: "allowlist",
      allowFrom: ["+15551234567"]
    }
  }
}
```

## ç›®æ¨™
- å–®ä¸€ Gateway ç¨‹åºä¸­çš„å¤šå€‹ WhatsApp å¸³æˆ¶ï¼ˆå¤šå¸³æˆ¶ï¼‰ã€‚
- ç¢ºå®šæ€§è·¯ç”±ï¼šå›è¦†è¿”å› WhatsAppï¼Œç„¡æ¨¡å‹è·¯ç”±ã€‚
- æ¨¡å‹çœ‹åˆ°è¶³å¤ çš„ä¸Šä¸‹æ–‡ä»¥ç†è§£å¼•ç”¨å›è¦†ã€‚

## è¨­å®šå¯«å…¥
é è¨­æƒ…æ³ä¸‹ï¼ŒWhatsApp å…è¨±å¯«å…¥ç”± `/config set|unset` è§¸ç™¼çš„è¨­å®šæ›´æ–°ï¼ˆéœ€è¦ `commands.config: true`ï¼‰ã€‚

ä½¿ç”¨ä»¥ä¸‹æ–¹å¼åœç”¨ï¼š
```json5
{
  channels: { whatsapp: { configWrites: false } }
}
```

## æ¶æ§‹ï¼ˆèª°æ“æœ‰ä»€éº¼ï¼‰
- **Gateway** æ“æœ‰ Baileys socket å’Œæ”¶ä»¶åŒ£å¾ªç’°ã€‚
- **CLI / macOS æ‡‰ç”¨ç¨‹å¼**èˆ‡ Gateway é€šè¨Šï¼›ä¸ç›´æ¥ä½¿ç”¨ Baileysã€‚
- å¤–ç™¼å‚³é€éœ€è¦**æ´»èºçš„ç›£è½å™¨**ï¼›å¦å‰‡å‚³é€æœƒå¿«é€Ÿå¤±æ•—ã€‚

## å–å¾—é›»è©±è™Ÿç¢¼ï¼ˆå…©ç¨®æ¨¡å¼ï¼‰

WhatsApp éœ€è¦çœŸå¯¦çš„æ‰‹æ©Ÿè™Ÿç¢¼é€²è¡Œé©—è­‰ã€‚VoIP å’Œè™›æ“¬è™Ÿç¢¼é€šå¸¸æœƒè¢«é˜»æ­¢ã€‚æœ‰å…©ç¨®æ”¯æ´çš„æ–¹å¼åœ¨ WhatsApp ä¸Šé‹è¡Œ OpenClawï¼š

### å°ˆç”¨è™Ÿç¢¼ï¼ˆå»ºè­°ï¼‰
ç‚º OpenClaw ä½¿ç”¨**ç¨ç«‹é›»è©±è™Ÿç¢¼**ã€‚æœ€ä½³ä½¿ç”¨è€…é«”é©—ï¼Œä¹¾æ·¨çš„è·¯ç”±ï¼Œæ²’æœ‰è‡ªèŠæ€ªç•°å•é¡Œã€‚ç†æƒ³è¨­å®šï¼š**å‚™ç”¨/èˆŠ Android æ‰‹æ©Ÿ + eSIM**ã€‚ä¿æŒåœ¨ Wi-Fi å’Œé›»æºä¸Šï¼Œä¸¦é€é QR é€£çµã€‚

**WhatsApp Businessï¼š** æ‚¨å¯ä»¥åœ¨åŒä¸€è£ç½®ä¸Šä½¿ç”¨ä¸åŒè™Ÿç¢¼çš„ WhatsApp Businessã€‚éå¸¸é©åˆå°‡æ‚¨çš„å€‹äºº WhatsApp åˆ†é–‹ â€” å®‰è£ WhatsApp Business ä¸¦åœ¨é‚£è£¡è¨»å†Š OpenClaw è™Ÿç¢¼ã€‚

**ç¯„ä¾‹è¨­å®šï¼ˆå°ˆç”¨è™Ÿç¢¼ï¼Œå–®ç”¨æˆ¶å…è¨±æ¸…å–®ï¼‰ï¼š**
```json5
{
  channels: {
    whatsapp: {
      dmPolicy: "allowlist",
      allowFrom: ["+15551234567"]
    }
  }
}
```

**é…å°æ¨¡å¼ï¼ˆå¯é¸ï¼‰ï¼š**
å¦‚æœæ‚¨æƒ³ä½¿ç”¨é…å°è€Œä¸æ˜¯å…è¨±æ¸…å–®ï¼Œå°‡ `channels.whatsapp.dmPolicy` è¨­ç‚º `pairing`ã€‚æœªçŸ¥ç™¼é€è€…æœƒæ”¶åˆ°é…å°ç¢¼ï¼›ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ‰¹å‡†ï¼š
`openclaw pairing approve whatsapp <code>`

### å€‹äººè™Ÿç¢¼ï¼ˆå‚™é¸ï¼‰
å¿«é€Ÿå‚™é¸ï¼šåœ¨**æ‚¨è‡ªå·±çš„è™Ÿç¢¼**ä¸Šé‹è¡Œ OpenClawã€‚çµ¦è‡ªå·±ç™¼è¨Šæ¯ï¼ˆWhatsAppã€Œçµ¦è‡ªå·±ç™¼è¨Šæ¯ã€ï¼‰é€²è¡Œæ¸¬è©¦ï¼Œé€™æ¨£æ‚¨å°±ä¸æœƒæ‰“æ“¾è¯çµ¡äººã€‚é æœŸåœ¨è¨­å®šå’Œå¯¦é©—æœŸé–“æœƒåœ¨æ‚¨çš„ä¸»æ‰‹æ©Ÿä¸Šè®€å–é©—è­‰ç¢¼ã€‚**å¿…é ˆå•Ÿç”¨è‡ªèŠæ¨¡å¼ã€‚**
ç•¶ç²¾éˆè©¢å•æ‚¨çš„å€‹äºº WhatsApp è™Ÿç¢¼æ™‚ï¼Œè¼¸å…¥æ‚¨å°‡ç™¼é€è¨Šæ¯çš„é›»è©±ï¼ˆæ‰€æœ‰è€…/ç™¼é€è€…ï¼‰ï¼Œè€Œä¸æ˜¯åŠ©ç†è™Ÿç¢¼ã€‚

**ç¯„ä¾‹è¨­å®šï¼ˆå€‹äººè™Ÿç¢¼ï¼Œè‡ªèŠï¼‰ï¼š**
```json
{
  "whatsapp": {
    "selfChatMode": true,
    "dmPolicy": "allowlist",
    "allowFrom": ["+15551234567"]
  }
}
```

ç•¶è¨­å®šæ™‚ï¼Œè‡ªèŠå›è¦†é è¨­ç‚º `[{identity.name}]`ï¼ˆå¦å‰‡ç‚º `[openclaw]`ï¼‰ï¼Œ
å¦‚æœ `messages.responsePrefix` æœªè¨­å®šã€‚æ˜ç¢ºè¨­å®šå®ƒä»¥è‡ªè¨‚æˆ–åœç”¨
å‰ç¶´ï¼ˆä½¿ç”¨ `""` ç§»é™¤å®ƒï¼‰ã€‚

### è™Ÿç¢¼ä¾†æºæç¤º
- **æ‚¨æ‰€åœ¨åœ‹å®¶è¡Œå‹•é›»ä¿¡å•†çš„æœ¬åœ° eSIM**ï¼ˆæœ€å¯é ï¼‰
  - å¥§åœ°åˆ©ï¼š[hot.at](https://www.hot.at)
  - è‹±åœ‹ï¼š[giffgaff](https://www.giffgaff.com) â€” å…è²» SIM å¡ï¼Œç„¡åˆç´„
- **é ä»˜ SIM å¡** â€” ä¾¿å®œï¼Œåªéœ€è¦æ¥æ”¶ä¸€æ¢é©—è­‰ç°¡è¨Š

**é¿å…ï¼š** TextNowã€Google Voiceã€å¤§å¤šæ•¸ã€Œå…è²»ç°¡è¨Šã€æœå‹™ â€” WhatsApp æœƒç©æ¥µé˜»æ­¢é€™äº›ã€‚

**æç¤ºï¼š** è™Ÿç¢¼åªéœ€è¦æ¥æ”¶ä¸€æ¢é©—è­‰ç°¡è¨Šã€‚ä¹‹å¾Œï¼ŒWhatsApp Web æœƒè©±é€é `creds.json` æŒçºŒå­˜åœ¨ã€‚

## ç‚ºä»€éº¼ä¸ç”¨ Twilioï¼Ÿ
- æ—©æœŸ OpenClaw ç‰ˆæœ¬æ”¯æ´ Twilio çš„ WhatsApp Business æ•´åˆã€‚
- WhatsApp Business è™Ÿç¢¼ä¸é©åˆå€‹äººåŠ©ç†ã€‚
- Meta å¼·åˆ¶åŸ·è¡Œ 24 å°æ™‚å›è¦†è¦–çª—ï¼›å¦‚æœæ‚¨åœ¨éå» 24 å°æ™‚å…§æ²’æœ‰å›æ‡‰ï¼Œå•†æ¥­è™Ÿç¢¼ç„¡æ³•ç™¼èµ·æ–°è¨Šæ¯ã€‚
- é«˜å®¹é‡æˆ–ã€ŒèŠå¤©å¼ã€ä½¿ç”¨æœƒè§¸ç™¼ç©æ¥µçš„é˜»æ­¢ï¼Œå› ç‚ºå•†æ¥­å¸³æˆ¶ä¸é©åˆç™¼é€æ•¸åæ¢å€‹äººåŠ©ç†è¨Šæ¯ã€‚
- çµæœï¼šäº¤ä»˜ä¸å¯é ä¸”é »ç¹è¢«é˜»æ­¢ï¼Œå› æ­¤ç§»é™¤äº†æ”¯æ´ã€‚

## ç™»å…¥ + æ†‘è­‰
- ç™»å…¥å‘½ä»¤ï¼š`openclaw channels login`ï¼ˆé€éå·²é€£çµè£ç½®çš„ QRï¼‰ã€‚
- å¤šå¸³æˆ¶ç™»å…¥ï¼š`openclaw channels login --account <id>`ï¼ˆ`<id>` = `accountId`ï¼‰ã€‚
- é è¨­å¸³æˆ¶ï¼ˆçœç•¥ `--account` æ™‚ï¼‰ï¼šå¦‚æœå­˜åœ¨å‰‡ç‚º `default`ï¼Œå¦å‰‡ç‚ºç¬¬ä¸€å€‹è¨­å®šçš„å¸³æˆ¶ IDï¼ˆå·²æ’åºï¼‰ã€‚
- æ†‘è­‰å„²å­˜åœ¨ `~/.openclaw/credentials/whatsapp/<accountId>/creds.json`ã€‚
- å‚™ä»½å‰¯æœ¬åœ¨ `creds.json.bak`ï¼ˆæå£æ™‚æ¢å¾©ï¼‰ã€‚
- èˆŠç‰ˆç›¸å®¹æ€§ï¼šè¼ƒèˆŠçš„å®‰è£ç›´æ¥åœ¨ `~/.openclaw/credentials/` ä¸­å„²å­˜ Baileys æª”æ¡ˆã€‚
- ç™»å‡ºï¼š`openclaw channels logout`ï¼ˆæˆ– `--account <id>`ï¼‰åˆªé™¤ WhatsApp èªè­‰ç‹€æ…‹ï¼ˆä½†ä¿ç•™å…±äº«çš„ `oauth.json`ï¼‰ã€‚
- å·²ç™»å‡ºçš„ socket => éŒ¯èª¤æŒ‡ç¤ºé‡æ–°é€£çµã€‚

## å…¥ç«™æµç¨‹ï¼ˆç§è¨Š + ç¾¤çµ„ï¼‰
- WhatsApp äº‹ä»¶ä¾†è‡ª `messages.upsert`ï¼ˆBaileysï¼‰ã€‚
- æ”¶ä»¶åŒ£ç›£è½å™¨åœ¨é—œé–‰æ™‚åˆ†é›¢ï¼Œä»¥é¿å…åœ¨æ¸¬è©¦/é‡å•Ÿæ™‚ç´¯ç©äº‹ä»¶è™•ç†å™¨ã€‚
- ç‹€æ…‹/å»£æ’­èŠå¤©è¢«å¿½ç•¥ã€‚
- ç›´æ¥èŠå¤©ä½¿ç”¨ E.164ï¼›ç¾¤çµ„ä½¿ç”¨ç¾¤çµ„ JIDã€‚
- **ç§è¨Šç­–ç•¥**ï¼š`channels.whatsapp.dmPolicy` æ§åˆ¶ç›´æ¥èŠå¤©å­˜å–ï¼ˆé è¨­ï¼š`pairing`ï¼‰ã€‚
  - é…å°ï¼šæœªçŸ¥ç™¼é€è€…æ”¶åˆ°é…å°ç¢¼ï¼ˆé€é `openclaw pairing approve whatsapp <code>` æ‰¹å‡†ï¼›ä»£ç¢¼åœ¨ 1 å°æ™‚å¾ŒéæœŸï¼‰ã€‚
  - é–‹æ”¾ï¼šéœ€è¦ `channels.whatsapp.allowFrom` åŒ…å« `"*"`ã€‚
  - æ‚¨é€£çµçš„ WhatsApp è™Ÿç¢¼éš±å¼å—ä¿¡ä»»ï¼Œå› æ­¤è‡ªèº«è¨Šæ¯è·³é `channels.whatsapp.dmPolicy` å’Œ `channels.whatsapp.allowFrom` æª¢æŸ¥ã€‚

### å€‹äººè™Ÿç¢¼æ¨¡å¼ï¼ˆå‚™é¸ï¼‰
å¦‚æœæ‚¨åœ¨**å€‹äºº WhatsApp è™Ÿç¢¼**ä¸Šé‹è¡Œ OpenClawï¼Œå•Ÿç”¨ `channels.whatsapp.selfChatMode`ï¼ˆè«‹åƒé–±ä¸Šé¢çš„ç¯„ä¾‹ï¼‰ã€‚

è¡Œç‚ºï¼š
- å¤–ç™¼ç§è¨Šæ°¸é ä¸æœƒè§¸ç™¼é…å°å›è¦†ï¼ˆé˜²æ­¢æ‰“æ“¾è¯çµ¡äººï¼‰ã€‚
- å…¥ç«™æœªçŸ¥ç™¼é€è€…ä»ç„¶éµå¾ª `channels.whatsapp.dmPolicy`ã€‚
- è‡ªèŠæ¨¡å¼ï¼ˆallowFrom åŒ…å«æ‚¨çš„è™Ÿç¢¼ï¼‰é¿å…è‡ªå‹•å·²è®€å›åŸ·ä¸¦å¿½ç•¥æåŠ JIDã€‚
- ç‚ºéè‡ªèŠç§è¨Šç™¼é€å·²è®€å›åŸ·ã€‚

## å·²è®€å›åŸ·
é è¨­æƒ…æ³ä¸‹ï¼ŒGateway æœƒå°‡å…¥ç«™ WhatsApp è¨Šæ¯æ¨™è¨˜ç‚ºå·²è®€ï¼ˆè—å‹¾ï¼‰ä¸€æ—¦è¢«æ¥å—ã€‚

å…¨åŸŸåœç”¨ï¼š
```json5
{
  channels: { whatsapp: { sendReadReceipts: false } }
}
```

æŒ‰å¸³æˆ¶åœç”¨ï¼š
```json5
{
  channels: {
    whatsapp: {
      accounts: {
        personal: { sendReadReceipts: false }
      }
    }
  }
}
```

å‚™è¨»ï¼š
- è‡ªèŠæ¨¡å¼å§‹çµ‚è·³éå·²è®€å›åŸ·ã€‚

## WhatsApp å¸¸è¦‹å•é¡Œï¼šç™¼é€è¨Šæ¯ + é…å°

**ç•¶æˆ‘é€£çµ WhatsApp æ™‚ï¼ŒOpenClaw æœƒçµ¦éš¨æ©Ÿè¯çµ¡äººç™¼è¨Šæ¯å—ï¼Ÿ**
ä¸æœƒã€‚é è¨­ç§è¨Šç­–ç•¥æ˜¯**é…å°**ï¼Œå› æ­¤æœªçŸ¥ç™¼é€è€…åªæœƒæ”¶åˆ°é…å°ç¢¼ï¼Œä»–å€‘çš„è¨Šæ¯**ä¸æœƒè¢«è™•ç†**ã€‚OpenClaw åªå›è¦†å®ƒæ”¶åˆ°çš„èŠå¤©ï¼Œæˆ–æ‚¨æ˜ç¢ºè§¸ç™¼çš„å‚³é€ï¼ˆä»£ç†/CLIï¼‰ã€‚

**WhatsApp ä¸Šçš„é…å°å¦‚ä½•é‹ä½œï¼Ÿ**
é…å°æ˜¯æœªçŸ¥ç™¼é€è€…çš„ç§è¨Šé–˜é–€ï¼š
- ä¾†è‡ªæ–°ç™¼é€è€…çš„ç¬¬ä¸€æ¢ç§è¨Šè¿”å›ä¸€å€‹çŸ­ä»£ç¢¼ï¼ˆè¨Šæ¯ä¸è¢«è™•ç†ï¼‰ã€‚
- ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ‰¹å‡†ï¼š`openclaw pairing approve whatsapp <code>`ï¼ˆä½¿ç”¨ `openclaw pairing list whatsapp` åˆ—å‡ºï¼‰ã€‚
- ä»£ç¢¼åœ¨ 1 å°æ™‚å¾ŒéæœŸï¼›æ¯å€‹é »é“çš„å¾…è™•ç†è«‹æ±‚ä¸Šé™ç‚º 3 å€‹ã€‚

**å¤šäººå¯ä»¥åœ¨ä¸€å€‹ WhatsApp è™Ÿç¢¼ä¸Šä½¿ç”¨ä¸åŒçš„ OpenClaw å¯¦ä¾‹å—ï¼Ÿ**
æ˜¯çš„ï¼Œé€é `bindings` å°‡æ¯å€‹ç™¼é€è€…è·¯ç”±åˆ°ä¸åŒçš„ä»£ç†ï¼ˆpeer `kind: "dm"`ï¼Œsender E.164 å¦‚ `+15551234567`ï¼‰ã€‚å›è¦†ä»ç„¶ä¾†è‡ª**åŒä¸€å€‹ WhatsApp å¸³æˆ¶**ï¼Œç›´æ¥èŠå¤©æœƒæ­¸ç´åˆ°æ¯å€‹ä»£ç†çš„ä¸»æœƒè©±ï¼Œå› æ­¤ä½¿ç”¨**æ¯äººä¸€å€‹ä»£ç†**ã€‚ç§è¨Šå­˜å–æ§åˆ¶ï¼ˆ`dmPolicy`/`allowFrom`ï¼‰æ˜¯æ¯å€‹ WhatsApp å¸³æˆ¶å…¨åŸŸçš„ã€‚è«‹åƒé–± [å¤šä»£ç†è·¯ç”±](/concepts/multi-agent)ã€‚

**ç‚ºä»€éº¼ç²¾éˆæœƒè©¢å•æˆ‘çš„é›»è©±è™Ÿç¢¼ï¼Ÿ**
ç²¾éˆä½¿ç”¨å®ƒä¾†è¨­å®šæ‚¨çš„**å…è¨±æ¸…å–®/æ‰€æœ‰è€…**ï¼Œä»¥ä¾¿æ‚¨è‡ªå·±çš„ç§è¨Šè¢«å…è¨±ã€‚å®ƒä¸ç”¨æ–¼è‡ªå‹•ç™¼é€ã€‚å¦‚æœæ‚¨åœ¨å€‹äºº WhatsApp è™Ÿç¢¼ä¸Šé‹è¡Œï¼Œä½¿ç”¨ç›¸åŒçš„è™Ÿç¢¼ä¸¦å•Ÿç”¨ `channels.whatsapp.selfChatMode`ã€‚

## è¨Šæ¯æ­£è¦åŒ–ï¼ˆæ¨¡å‹çœ‹åˆ°ä»€éº¼ï¼‰
- `Body` æ˜¯å¸¶æœ‰ä¿¡å°çš„ç•¶å‰è¨Šæ¯æ­£æ–‡ã€‚
- å¼•ç”¨å›è¦†ä¸Šä¸‹æ–‡**å§‹çµ‚é™„åŠ **ï¼š
  ```
  [Replying to +1555 id:ABC123]
  <quoted text or <media:...>>
  [/Replying]
  ```
- å›è¦†å…ƒè³‡æ–™ä¹Ÿè¨­å®šï¼š
  - `ReplyToId` = stanzaId
  - `ReplyToBody` = å¼•ç”¨æ­£æ–‡æˆ–åª’é«”ä½”ä½ç¬¦
  - `ReplyToSender` = å·²çŸ¥æ™‚ç‚º E.164
- åƒ…åª’é«”çš„å…¥ç«™è¨Šæ¯ä½¿ç”¨ä½”ä½ç¬¦ï¼š
  - `<media:image|video|audio|document|sticker>`

## ç¾¤çµ„
- ç¾¤çµ„å°æ‡‰åˆ° `agent:<agentId>:whatsapp:group:<jid>` æœƒè©±ã€‚
- ç¾¤çµ„ç­–ç•¥ï¼š`channels.whatsapp.groupPolicy = open|disabled|allowlist`ï¼ˆé è¨­ `allowlist`ï¼‰ã€‚
- å•Ÿå‹•æ¨¡å¼ï¼š
  - `mention`ï¼ˆé è¨­ï¼‰ï¼šéœ€è¦ @æåŠæˆ–æ­£å‰‡è¡¨é”å¼åŒ¹é…ã€‚
  - `always`ï¼šå§‹çµ‚è§¸ç™¼ã€‚
- `/activation mention|always` æ˜¯åƒ…é™æ‰€æœ‰è€…çš„ï¼Œå¿…é ˆä½œç‚ºç¨ç«‹è¨Šæ¯ç™¼é€ã€‚
- æ‰€æœ‰è€… = `channels.whatsapp.allowFrom`ï¼ˆå¦‚æœæœªè¨­å®šå‰‡ç‚ºè‡ªèº« E.164ï¼‰ã€‚
- **æ­·å²æ³¨å…¥**ï¼ˆåƒ…å¾…è™•ç†ï¼‰ï¼š
  - æœ€è¿‘*æœªè™•ç†*çš„è¨Šæ¯ï¼ˆé è¨­ 50ï¼‰æ’å…¥åœ¨ï¼š
    `[Chat messages since your last reply - for context]`ï¼ˆå·²åœ¨æœƒè©±ä¸­çš„è¨Šæ¯ä¸æœƒé‡æ–°æ³¨å…¥ï¼‰
  - ç•¶å‰è¨Šæ¯åœ¨ï¼š
    `[Current message - respond to this]`
  - é™„åŠ ç™¼é€è€…å¾Œç¶´ï¼š`[from: Name (+E164)]`
- ç¾¤çµ„å…ƒè³‡æ–™å¿«å– 5 åˆ†é˜ï¼ˆä¸»é¡Œ + åƒèˆ‡è€…ï¼‰ã€‚

## å›è¦†äº¤ä»˜ï¼ˆä¸²é€£ï¼‰
- WhatsApp Web ç™¼é€æ¨™æº–è¨Šæ¯ï¼ˆç•¶å‰ Gateway ä¸­æ²’æœ‰å¼•ç”¨å›è¦†ä¸²é€£ï¼‰ã€‚
- æ­¤é »é“å¿½ç•¥å›è¦†æ¨™ç±¤ã€‚

## ç¢ºèªåæ‡‰ï¼ˆæ”¶åˆ°æ™‚è‡ªå‹•åæ‡‰ï¼‰

WhatsApp å¯ä»¥åœ¨æ”¶åˆ°å…¥ç«™è¨Šæ¯æ™‚ç«‹å³è‡ªå‹•ç™¼é€è¡¨æƒ…ç¬¦è™Ÿåæ‡‰ï¼Œåœ¨æ©Ÿå™¨äººç”Ÿæˆå›è¦†ä¹‹å‰ã€‚é€™ç‚ºç”¨æˆ¶æä¾›å³æ™‚åé¥‹ï¼Œè¡¨æ˜ä»–å€‘çš„è¨Šæ¯å·²è¢«æ¥æ”¶ã€‚

**è¨­å®šï¼š**
```json
{
  "whatsapp": {
    "ackReaction": {
      "emoji": "ğŸ‘€",
      "direct": true,
      "group": "mentions"
    }
  }
}
```

**é¸é …ï¼š**
- `emoji`ï¼ˆå­—ä¸²ï¼‰ï¼šç”¨æ–¼ç¢ºèªçš„è¡¨æƒ…ç¬¦è™Ÿï¼ˆä¾‹å¦‚ã€ŒğŸ‘€ã€ã€ã€Œâœ…ã€ã€ã€ŒğŸ“¨ã€ï¼‰ã€‚ç©ºæˆ–çœç•¥ = åŠŸèƒ½åœç”¨ã€‚
- `direct`ï¼ˆå¸ƒæ—ï¼Œé è¨­ï¼š`true`ï¼‰ï¼šåœ¨ç›´æ¥/ç§è¨ŠèŠå¤©ä¸­ç™¼é€åæ‡‰ã€‚
- `group`ï¼ˆå­—ä¸²ï¼Œé è¨­ï¼š`"mentions"`ï¼‰ï¼šç¾¤çµ„èŠå¤©è¡Œç‚ºï¼š
  - `"always"`ï¼šå°æ‰€æœ‰ç¾¤çµ„è¨Šæ¯åæ‡‰ï¼ˆå³ä½¿æ²’æœ‰ @æåŠï¼‰
  - `"mentions"`ï¼šåƒ…åœ¨æ©Ÿå™¨äººè¢« @æåŠæ™‚åæ‡‰
  - `"never"`ï¼šæ°¸é ä¸åœ¨ç¾¤çµ„ä¸­åæ‡‰

**æŒ‰å¸³æˆ¶è¦†å¯«ï¼š**
```json
{
  "whatsapp": {
    "accounts": {
      "work": {
        "ackReaction": {
          "emoji": "âœ…",
          "direct": false,
          "group": "always"
        }
      }
    }
  }
}
```

**è¡Œç‚ºå‚™è¨»ï¼š**
- åæ‡‰åœ¨è¨Šæ¯æ”¶åˆ°æ™‚**ç«‹å³**ç™¼é€ï¼Œåœ¨è¼¸å…¥æŒ‡ç¤ºå™¨æˆ–æ©Ÿå™¨äººå›è¦†ä¹‹å‰ã€‚
- åœ¨ `requireMention: false`ï¼ˆå•Ÿå‹•ï¼šalwaysï¼‰çš„ç¾¤çµ„ä¸­ï¼Œ`group: "mentions"` å°‡å°æ‰€æœ‰è¨Šæ¯åæ‡‰ï¼ˆä¸åƒ…æ˜¯ @æåŠï¼‰ã€‚
- ç™¼é€å¾Œä¸ç®¡ï¼šåæ‡‰å¤±æ•—æœƒè¢«è¨˜éŒ„ä½†ä¸æœƒé˜»æ­¢æ©Ÿå™¨äººå›è¦†ã€‚
- åƒèˆ‡è€… JID æœƒè‡ªå‹•åŒ…å«åœ¨ç¾¤çµ„åæ‡‰ä¸­ã€‚
- WhatsApp å¿½ç•¥ `messages.ackReaction`ï¼›è«‹æ”¹ç”¨ `channels.whatsapp.ackReaction`ã€‚

## ä»£ç†å·¥å…·ï¼ˆåæ‡‰ï¼‰
- å·¥å…·ï¼š`whatsapp` å¸¶æœ‰ `react` å‹•ä½œï¼ˆ`chatJid`ã€`messageId`ã€`emoji`ã€å¯é¸ `remove`ï¼‰ã€‚
- å¯é¸ï¼š`participant`ï¼ˆç¾¤çµ„ç™¼é€è€…ï¼‰ã€`fromMe`ï¼ˆå°æ‚¨è‡ªå·±çš„è¨Šæ¯åæ‡‰ï¼‰ã€`accountId`ï¼ˆå¤šå¸³æˆ¶ï¼‰ã€‚
- åæ‡‰ç§»é™¤èªæ„ï¼šè«‹åƒé–± [/tools/reactions](/tools/reactions)ã€‚
- å·¥å…·é–˜é–€ï¼š`channels.whatsapp.actions.reactions`ï¼ˆé è¨­ï¼šå•Ÿç”¨ï¼‰ã€‚

## é™åˆ¶
- å¤–ç™¼æ–‡å­—åˆ†å¡Šè‡³ `channels.whatsapp.textChunkLimit`ï¼ˆé è¨­ 4000ï¼‰ã€‚
- å¯é¸çš„æ›è¡Œåˆ†å¡Šï¼šè¨­å®š `channels.whatsapp.chunkMode="newline"` åœ¨é•·åº¦åˆ†å¡Šå‰åœ¨ç©ºç™½è¡Œï¼ˆæ®µè½é‚Šç•Œï¼‰åˆ†å‰²ã€‚
- å…¥ç«™åª’é«”å„²å­˜ä¸Šé™ç‚º `channels.whatsapp.mediaMaxMb`ï¼ˆé è¨­ 50 MBï¼‰ã€‚
- å¤–ç™¼åª’é«”é …ç›®ä¸Šé™ç‚º `agents.defaults.mediaMaxMb`ï¼ˆé è¨­ 5 MBï¼‰ã€‚

## å¤–ç™¼å‚³é€ï¼ˆæ–‡å­— + åª’é«”ï¼‰
- ä½¿ç”¨æ´»èºçš„ç¶²é ç›£è½å™¨ï¼›å¦‚æœ Gateway æœªé‹è¡Œå‰‡éŒ¯èª¤ã€‚
- æ–‡å­—åˆ†å¡Šï¼šæ¯æ¢è¨Šæ¯æœ€å¤§ 4kï¼ˆå¯é€é `channels.whatsapp.textChunkLimit`ã€å¯é¸ `channels.whatsapp.chunkMode` è¨­å®šï¼‰ã€‚
- åª’é«”ï¼š
  - æ”¯æ´åœ–ç‰‡/å½±ç‰‡/éŸ³è¨Š/æ–‡ä»¶ã€‚
  - éŸ³è¨Šä»¥ PTT ç™¼é€ï¼›`audio/ogg` => `audio/ogg; codecs=opus`ã€‚
  - èªªæ˜æ–‡å­—åƒ…åœ¨ç¬¬ä¸€å€‹åª’é«”é …ç›®ä¸Šã€‚
  - åª’é«”ç²å–æ”¯æ´ HTTP(S) å’Œæœ¬åœ°è·¯å¾‘ã€‚
  - å‹•ç•« GIFï¼šWhatsApp é æœŸå¸¶æœ‰ `gifPlayback: true` çš„ MP4 ä»¥é€²è¡Œå…§è¯å¾ªç’°ã€‚
    - CLIï¼š`openclaw message send --media <mp4> --gif-playback`
    - Gatewayï¼š`send` åƒæ•¸åŒ…å« `gifPlayback: true`

## èªéŸ³è¨Šæ¯ï¼ˆPTT éŸ³è¨Šï¼‰
WhatsApp å°‡éŸ³è¨Šä½œç‚º**èªéŸ³è¨Šæ¯**ï¼ˆPTT æ°£æ³¡ï¼‰ç™¼é€ã€‚
- æœ€ä½³æ•ˆæœï¼šOGG/Opusã€‚OpenClaw å°‡ `audio/ogg` é‡å¯«ç‚º `audio/ogg; codecs=opus`ã€‚
- WhatsApp å¿½ç•¥ `[[audio_as_voice]]`ï¼ˆéŸ³è¨Šå·²ä½œç‚ºèªéŸ³è¨Šæ¯ç™¼é€ï¼‰ã€‚

## åª’é«”é™åˆ¶ + å„ªåŒ–
- é è¨­å¤–ç™¼ä¸Šé™ï¼š5 MBï¼ˆæ¯å€‹åª’é«”é …ç›®ï¼‰ã€‚
- è¦†å¯«ï¼š`agents.defaults.mediaMaxMb`ã€‚
- åœ–ç‰‡åœ¨ä¸Šé™å…§è‡ªå‹•å„ªåŒ–ç‚º JPEGï¼ˆèª¿æ•´å¤§å° + å“è³ªæƒæï¼‰ã€‚
- è¶…å¤§åª’é«” => éŒ¯èª¤ï¼›åª’é«”å›è¦†å›é€€åˆ°æ–‡å­—è­¦å‘Šã€‚

## å¿ƒè·³
- **Gateway å¿ƒè·³**è¨˜éŒ„é€£ç·šå¥åº·ï¼ˆ`web.heartbeatSeconds`ï¼Œé è¨­ 60 ç§’ï¼‰ã€‚
- **ä»£ç†å¿ƒè·³**å¯ä»¥æŒ‰ä»£ç†è¨­å®šï¼ˆ`agents.list[].heartbeat`ï¼‰æˆ–å…¨åŸŸ
  é€é `agents.defaults.heartbeat`ï¼ˆæœªè¨­å®šæŒ‰ä»£ç†æ¢ç›®æ™‚çš„å‚™é¸ï¼‰ã€‚
  - ä½¿ç”¨è¨­å®šçš„å¿ƒè·³æç¤ºï¼ˆé è¨­ï¼š`Read HEARTBEAT.md if it exists (workspace context). Follow it strictly. Do not infer or repeat old tasks from prior chats. If nothing needs attention, reply HEARTBEAT_OK.`ï¼‰+ `HEARTBEAT_OK` è·³éè¡Œç‚ºã€‚
  - äº¤ä»˜é è¨­ç‚ºæœ€å¾Œä½¿ç”¨çš„é »é“ï¼ˆæˆ–è¨­å®šçš„ç›®æ¨™ï¼‰ã€‚

## é‡æ–°é€£ç·šè¡Œç‚º
- é€€é¿ç­–ç•¥ï¼š`web.reconnect`ï¼š
  - `initialMs`ã€`maxMs`ã€`factor`ã€`jitter`ã€`maxAttempts`ã€‚
- å¦‚æœé”åˆ° maxAttemptsï¼Œç¶²é ç›£æ§åœæ­¢ï¼ˆé™ç´šï¼‰ã€‚
- å·²ç™»å‡º => åœæ­¢ä¸¦éœ€è¦é‡æ–°é€£çµã€‚

## è¨­å®šå¿«é€Ÿå°ç…§
- `channels.whatsapp.dmPolicy`ï¼ˆç§è¨Šç­–ç•¥ï¼špairing/allowlist/open/disabledï¼‰ã€‚
- `channels.whatsapp.selfChatMode`ï¼ˆåŒé›»è©±è¨­å®šï¼›æ©Ÿå™¨äººä½¿ç”¨æ‚¨çš„å€‹äºº WhatsApp è™Ÿç¢¼ï¼‰ã€‚
- `channels.whatsapp.allowFrom`ï¼ˆç§è¨Šå…è¨±æ¸…å–®ï¼‰ã€‚WhatsApp ä½¿ç”¨ E.164 é›»è©±è™Ÿç¢¼ï¼ˆç„¡ç”¨æˆ¶åï¼‰ã€‚
- `channels.whatsapp.mediaMaxMb`ï¼ˆå…¥ç«™åª’é«”å„²å­˜ä¸Šé™ï¼‰ã€‚
- `channels.whatsapp.ackReaction`ï¼ˆè¨Šæ¯æ”¶åˆ°æ™‚çš„è‡ªå‹•åæ‡‰ï¼š`{emoji, direct, group}`ï¼‰ã€‚
- `channels.whatsapp.accounts.<accountId>.*`ï¼ˆæŒ‰å¸³æˆ¶è¨­å®š + å¯é¸ `authDir`ï¼‰ã€‚
- `channels.whatsapp.accounts.<accountId>.mediaMaxMb`ï¼ˆæŒ‰å¸³æˆ¶å…¥ç«™åª’é«”ä¸Šé™ï¼‰ã€‚
- `channels.whatsapp.accounts.<accountId>.ackReaction`ï¼ˆæŒ‰å¸³æˆ¶ç¢ºèªåæ‡‰è¦†å¯«ï¼‰ã€‚
- `channels.whatsapp.groupAllowFrom`ï¼ˆç¾¤çµ„ç™¼é€è€…å…è¨±æ¸…å–®ï¼‰ã€‚
- `channels.whatsapp.groupPolicy`ï¼ˆç¾¤çµ„ç­–ç•¥ï¼‰ã€‚
- `channels.whatsapp.historyLimit` / `channels.whatsapp.accounts.<accountId>.historyLimit`ï¼ˆç¾¤çµ„æ­·å²ä¸Šä¸‹æ–‡ï¼›`0` åœç”¨ï¼‰ã€‚
- `channels.whatsapp.dmHistoryLimit`ï¼ˆç”¨æˆ¶è¼ªæ¬¡ä¸­çš„ç§è¨Šæ­·å²é™åˆ¶ï¼‰ã€‚æŒ‰ç”¨æˆ¶è¦†å¯«ï¼š`channels.whatsapp.dms["<phone>"].historyLimit`ã€‚
- `channels.whatsapp.groups`ï¼ˆç¾¤çµ„å…è¨±æ¸…å–® + æåŠé–˜é–€é è¨­ï¼›ä½¿ç”¨ `"*"` å…è¨±å…¨éƒ¨ï¼‰
- `channels.whatsapp.actions.reactions`ï¼ˆWhatsApp å·¥å…·åæ‡‰é–˜é–€ï¼‰ã€‚
- `agents.list[].groupChat.mentionPatterns`ï¼ˆæˆ– `messages.groupChat.mentionPatterns`ï¼‰
- `messages.groupChat.historyLimit`
- `channels.whatsapp.messagePrefix`ï¼ˆå…¥ç«™å‰ç¶´ï¼›æŒ‰å¸³æˆ¶ï¼š`channels.whatsapp.accounts.<accountId>.messagePrefix`ï¼›å·²æ£„ç”¨ï¼š`messages.messagePrefix`ï¼‰
- `messages.responsePrefix`ï¼ˆå¤–ç™¼å‰ç¶´ï¼‰
- `agents.defaults.mediaMaxMb`
- `agents.defaults.heartbeat.every`
- `agents.defaults.heartbeat.model`ï¼ˆå¯é¸è¦†å¯«ï¼‰
- `agents.defaults.heartbeat.target`
- `agents.defaults.heartbeat.to`
- `agents.defaults.heartbeat.session`
- `agents.list[].heartbeat.*`ï¼ˆæŒ‰ä»£ç†è¦†å¯«ï¼‰
- `session.*`ï¼ˆscopeã€idleã€storeã€mainKeyï¼‰
- `web.enabled`ï¼ˆç‚º false æ™‚åœç”¨é »é“å•Ÿå‹•ï¼‰
- `web.heartbeatSeconds`
- `web.reconnect.*`

## æ—¥èªŒ + ç–‘é›£æ’è§£
- å­ç³»çµ±ï¼š`whatsapp/inbound`ã€`whatsapp/outbound`ã€`web-heartbeat`ã€`web-reconnect`ã€‚
- æ—¥èªŒæª”æ¡ˆï¼š`/tmp/openclaw/openclaw-YYYY-MM-DD.log`ï¼ˆå¯è¨­å®šï¼‰ã€‚
- ç–‘é›£æ’è§£æŒ‡å—ï¼š[Gateway ç–‘é›£æ’è§£](/gateway/troubleshooting)ã€‚

## ç–‘é›£æ’è§£ï¼ˆå¿«é€Ÿï¼‰

**æœªé€£çµ / éœ€è¦ QR ç™»å…¥**
- ç—‡ç‹€ï¼š`channels status` é¡¯ç¤º `linked: false` æˆ–è­¦å‘Šã€ŒNot linkedã€ã€‚
- ä¿®å¾©ï¼šåœ¨ Gateway ä¸»æ©Ÿä¸ŠåŸ·è¡Œ `openclaw channels login` ä¸¦æƒæ QRï¼ˆWhatsApp â†’ è¨­å®š â†’ å·²é€£çµè£ç½®ï¼‰ã€‚

**å·²é€£çµä½†æ–·é–‹é€£ç·š / é‡æ–°é€£ç·šå¾ªç’°**
- ç—‡ç‹€ï¼š`channels status` é¡¯ç¤º `running, disconnected` æˆ–è­¦å‘Šã€ŒLinked but disconnectedã€ã€‚
- ä¿®å¾©ï¼š`openclaw doctor`ï¼ˆæˆ–é‡å•Ÿ Gatewayï¼‰ã€‚å¦‚æœæŒçºŒç™¼ç”Ÿï¼Œé€é `channels login` é‡æ–°é€£çµä¸¦æª¢æŸ¥ `openclaw logs --follow`ã€‚

**Bun é‹è¡Œæ™‚**
- **ä¸å»ºè­°**ä½¿ç”¨ Bunã€‚WhatsAppï¼ˆBaileysï¼‰å’Œ Telegram åœ¨ Bun ä¸Šä¸å¯é ã€‚
  ä½¿ç”¨ **Node** é‹è¡Œ Gatewayã€‚ï¼ˆè«‹åƒé–±å…¥é–€é‹è¡Œæ™‚å‚™è¨»ã€‚ï¼‰
