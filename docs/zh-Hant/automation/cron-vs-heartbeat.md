---
title: "Cron vs heartbeat(Cron 與 Heartbeat 選擇指南)"
summary: "為自動化任務選擇合適的機制：排程任務 (Cron) 還是心跳機制 (Heartbeat)"
read_when:
  - 決定如何安排定期任務時
  - 設定背景監控或通知時
  - 為定期檢查優化 Token 使用量時
---

# Cron vs Heartbeat: 該選擇哪一個？

「心跳 (Heartbeat)」與「排程任務 (Cron)」都能讓您定期執行任務。本指南將協助您根據使用場景選擇最合適的機制。

## 快速決策矩陣

| 使用場景 | 推薦建議 | 原因 |
|----------|-------------|-----|
| 每 30 分鐘檢查收件匣 | Heartbeat | 可與其他檢查合併，具備語境意識 |
| 每天早上 9 點準時發送報告 | Cron (隔離模式) | 需要精確的時間點 |
| 監控行事曆中的即將到來事件 | Heartbeat | 最適合用於週期性的自我覺察 |
| 執行每週深度分析 | Cron (隔離模式) | 獨立任務，可使用更強大的模型 |
| 20 分鐘後提醒我 | Cron (主會話, `--at`) | 具備精確時間點的單次任務 |
| 背景專案健康檢查 | Heartbeat | 可依附於現有的循環中執行 |

## 心跳機制 (Heartbeat)：週期性的自我覺察

心跳機制以固定的時間間隔（預設 30 分鐘）在**主會話 (Main session)** 中執行。它的設計初衷是讓 Agent 主動檢查各項事物，並在發現重要事項時主動回報。

### 適用場景
- **合併多項定期檢查**：比起設定 5 個獨立的 Cron 任務來檢查郵件、行事曆、天氣等，單次心跳即可批次處理。
- **具備語境意識的決策**：Agent 擁有完整的會話語境，可以判斷哪些事情緊急，哪些可以稍後再說。
- **對話連續性**：心跳執行與一般對話共享同一個會話，Agent 會記得最近處理的事項。
- **低資源開銷監控**：單次心跳能取代多個小型輪詢任務。

### 心跳機制優勢
- **批次處理**：一次 Agent 輪次即可檢閱收件匣、行事曆與通知。
- **減少 API 呼叫**：單次心跳通常比執行 5 次隔離的 Cron 任務更便宜。
- **智慧抑制**：若沒發生任何需要注意的事，Agent 只會回覆 `HEARTBEAT_OK` 且不會發送訊息。

### 心跳範例：HEARTBEAT.md 檢查清單
```md
# 心跳檢查清單
- 檢查電子郵件是否有緊急訊息
- 檢閱未來 2 小時內的行事曆事件
- 若有背景任務完成，摘要其結果
- 若閒置超過 8 小時，發送簡短問候
```
Agent 會在每次心跳時讀取此清單並一併處理。

## 排程任務 (Cron)：精確的排程執行

Cron 任務執行於**精確的時間點**，且可以在隔離的會話中執行而不影響主會話語境。

### 適用場景
- **需要精確時間**：「每週一早上 9:00 準時發送」，而非「9 點前後某個時間」。
- **獨立任務**：不需要前言後語語境的任務。
- **不同的模型或思考等級**：需要耗費大量效能分析，值得動用更強大模型（如 Opus）的情況。
- **單次提醒**：使用 `--at` 設定「20 分鐘後提醒我」。
- **頻繁或資訊量大的任務**：不希望這些內容塞滿主會話紀錄。

### Cron 優勢
- **精確對時**：支援 5 欄位 Cron 表達式與時區。
- **會話隔離**：在 `cron:<jobId>` 中執行，不會污染主對話歷史。
- **模型覆寫**：可為每個任務單獨指定更便宜或更強大的模型。
- **投遞控制**：可直接發送至特定頻道。

### Cron 範例：每日早晨簡報
```bash
openclaw cron add \
  --name "Morning briefing" \
  --cron "0 7 * * *" \
  --tz "Asia/Taipei" \
  --session isolated \
  --message "生成今日簡報：包含天氣、行事曆、重要郵件與新聞摘要。" \
  --model opus \
  --deliver \
  --channel whatsapp \
  --to "+886912345678"
```

## 決策流程圖 (Decision Flowchart)

```text
這項任務需要在「精確」的時間執行嗎？
  是 -> 使用 Cron
  否 -> 繼續...

這項任務需要與主會話保持隔離嗎？
  是 -> 使用 Cron (隔離模式)
  否 -> 繼續...

這項任務可以與其他定期檢查合併嗎？
  是 -> 使用 Heartbeat (加入 HEARTBEAT.md)
  否 -> 使用 Cron

這是一次性的提醒嗎？
  是 -> 使用 Cron --at
  否 -> 繼續...
```

## 混合並用 (Combining Both)

最高效的配置是**兩者並用**：
1. **Heartbeat**：每 30 分鐘執行一次，處理例行監控（收件匣、行事曆）。
2. **Cron**：處理精確排程（每日分析報告、每週檢討）以及單次提醒。
