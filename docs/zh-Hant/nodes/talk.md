---
title: "Talk(對話模式)"
summary: "對話模式：使用 ElevenLabs TTS 進行連續語音通訊"
read_when:
  - 在 macOS/iOS/Android 上實作對話模式時
  - 變更聲音/TTS/中斷行為時
---

# 對話模式 (Talk Mode)

對話模式是一個連續的語音對話循環：
1. **聆聽**：捕捉使用者語音。
2. **處理**：將轉錄內容發送至模型（使用主會話 `chat.send`）。
3. **回傳**：等待模型回應。
4. **朗讀**：透由 ElevenLabs 進行語音合成（串流播放）。

## 行為與特性 (macOS)
- **懸浮視窗**：啟用後會顯示一個「始終在上」的懸浮介面。
- **狀態切換**：包含「正在聆聽 → 思考中 → 正在說話」三個階段。
- **自動發送**：使用者發言後的短暫停頓（靜音視窗）會觸發傳送。
- **語音中斷 (Interrupt on speech)**：預設啟動。若助理說話時使用者開始發言，系統會立即停止播放，並記錄中斷的時間點以在下一次 Prompt 中給模型參考。

## 回應中的語音指令
模型可以在回覆的第一行加入一段 **JSON 指令**來控制語音輸出：

```json
{"voice":"語音ID","once":true}
```

規則說明：
- 僅限第一行非空行。
- 未識別的鍵值將被忽略。
- `once: true` 表示該設定僅套用於本次回覆。
- 若無 `once` 標記，該聲音將成為對話模式的新預設值。

## 配置說明 (`~/.openclaw/openclaw.json`)
```json5
{
  "talk": {
    "voiceId": "elevenlabs_voice_id",
    "modelId": "eleven_v3",
    "apiKey": "您的金鑰",
    "interruptOnSpeech": true // 是否允許使用者中斷
  }
}
```

## macOS 介面說明
- **正在聆聽**：雲朵圖示會隨麥克風音量脈動。
- **思考中**：雲朵呈現下沉動畫。
- **正在說話**：雲朵會產生向外擴散的圓圈。
- **操作快捷**：點擊雲朵可停止說話；點擊 X 退出對話模式。

## 注意事項
- 需要系統的「語音辨識」與「麥克風」權限。
- TTS 使用 ElevenLabs 的串流 API，並在各平台上使用漸進式播放技術以降低延遲。
- Android 支援多種 PCM 輸出格式（如 `pcm_24000`），以支援低延遲的 AudioTrack 串流。
