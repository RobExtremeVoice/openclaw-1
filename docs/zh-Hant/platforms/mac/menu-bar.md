---
title: "menu-bar(Menu Bar Status Logic)"
summary: "é¸å–®åˆ—ç‹€æ…‹é‚è¼¯èˆ‡å‘ˆç¾çµ¦ä½¿ç”¨è€…çš„è³‡è¨Š"
read_when:
  - èª¿æ•´ mac é¸å–® UI æˆ–ç‹€æ…‹é‚è¼¯æ™‚
---

# é¸å–®åˆ—ç‹€æ…‹é‚è¼¯

## é¡¯ç¤ºå…§å®¹
- æˆ‘å€‘æœƒåœ¨é¸å–®åˆ—åœ–ç¤ºèˆ‡é¸å–®çš„ç¬¬ä¸€è¡Œç‹€æ…‹åˆ—ä¸­é¡¯ç¤ºç›®å‰çš„ Agent å·¥ä½œç‹€æ…‹ã€‚
- ç•¶æœ‰å·¥ä½œé€²è¡Œæ™‚ï¼Œå¥åº·ç‹€æ…‹æœƒè¢«éš±è—ï¼›ç•¶æ‰€æœ‰å·¥ä½œéšæ®µé–’ç½®æ™‚ï¼Œå¥åº·ç‹€æ…‹æœƒé‡æ–°å‡ºç¾ã€‚
- é¸å–®ä¸­çš„ã€ŒNodesã€å€å¡Šåƒ…åˆ—å‡º **è£ç½®**ï¼ˆé€é `node.list` é…å°çš„ç¯€é»ï¼‰ï¼Œä¸åˆ—å‡ºç”¨æˆ¶ç«¯/å­˜åœ¨ (presence) é …ç›®ã€‚
- ç•¶æœ‰ä¾›æ‡‰å•†ä½¿ç”¨é‡å¿«ç…§å¯ç”¨æ™‚ï¼Œã€ŒUsageã€å€å¡Šæœƒå‡ºç¾åœ¨ Context ä¸‹æ–¹ã€‚

## ç‹€æ…‹æ¨¡å‹
- å·¥ä½œéšæ®µ (Sessions): äº‹ä»¶åŒ…å« `runId` (æ¯æ¬¡åŸ·è¡Œ) èˆ‡ payload ä¸­çš„ `sessionKey`ã€‚
  ã€ŒMainã€å·¥ä½œéšæ®µçš„éµå€¼ç‚º `main`ï¼›è‹¥ä¸å­˜åœ¨ï¼Œæˆ‘å€‘æœƒé€€å›è‡³æœ€è¿‘æ›´æ–°çš„å·¥ä½œéšæ®µã€‚
- å„ªå…ˆé †åº: Main æ°¸é å„ªå…ˆã€‚è‹¥ Main è™•æ–¼æ´»å‹•ç‹€æ…‹ï¼Œæœƒç«‹å³é¡¯ç¤ºå…¶ç‹€æ…‹ã€‚è‹¥ Main é–’ç½®ï¼Œå‰‡é¡¯ç¤ºæœ€è¿‘æ´»å‹•çš„é Main å·¥ä½œéšæ®µã€‚æˆ‘å€‘ä¸æœƒåœ¨æ´»å‹•ä¸­é€”åè¦†åˆ‡æ›ï¼›åƒ…åœ¨ç•¶å‰å·¥ä½œéšæ®µè®Šç‚ºé–’ç½®æˆ– Main è®Šç‚ºæ´»å‹•ç‹€æ…‹æ™‚åˆ‡æ›ã€‚
- æ´»å‹•ç¨®é¡ (Activity kinds):
  - `job`: é«˜å±¤ç´šæŒ‡ä»¤åŸ·è¡Œ (`state: started|streaming|done|error`)ã€‚
  - `tool`: `phase: start|result` å¸¶æœ‰ `toolName` èˆ‡ `meta/args`ã€‚

## IconState åˆ—èˆ‰ (Swift)
- `idle`
- `workingMain(ActivityKind)`
- `workingOther(ActivityKind)`
- `overridden(ActivityKind)` (é™¤éŒ¯è¦†è“‹)

### ActivityKind â†’ åœ–å½¢ (Glyph)
- `exec` â†’ ğŸ’»
- `read` â†’ ğŸ“„
- `write` â†’ âœï¸
- `edit` â†’ ğŸ“
- `attach` â†’ ğŸ“
- default â†’ ğŸ› ï¸

### è¦–è¦ºå°æ‡‰
- `idle`: æ­£å¸¸ç”Ÿç‰©åœ–ç¤ºã€‚
- `workingMain`: å¸¶æœ‰åœ–å½¢å¾½ç« ã€å…¨è‰²èª¿ã€è…¿éƒ¨ã€Œå·¥ä½œä¸­ã€å‹•ç•«ã€‚
- `workingOther`: å¸¶æœ‰åœ–å½¢å¾½ç« ã€æ·¡åŒ–è‰²èª¿ã€ç„¡å¿«é€Ÿç§»å‹•ã€‚
- `overridden`: ç„¡è¦–æ´»å‹•ç‹€æ…‹ï¼Œä½¿ç”¨é¸å®šçš„åœ–å½¢/è‰²èª¿ã€‚

## ç‹€æ…‹åˆ—æ–‡å­— (é¸å–®)
- ç•¶å·¥ä½œé€²è¡Œæ™‚: `<Session role> Â· <activity label>`
  - ç¯„ä¾‹: `Main Â· exec: pnpm test`, `Other Â· read: apps/macos/Sources/OpenClaw/AppState.swift`.
- ç•¶é–’ç½®æ™‚: é€€å›é¡¯ç¤ºå¥åº·æ‘˜è¦ã€‚

## äº‹ä»¶æ”å– (Event ingestion)
- ä¾†æº: æ§åˆ¶é »é“ `agent` äº‹ä»¶ (`ControlChannel.handleAgentEvent`)ã€‚
- è§£ææ¬„ä½:
  - `stream: "job"` å¸¶æœ‰ `data.state` ç”¨æ–¼é–‹å§‹/åœæ­¢ã€‚
  - `stream: "tool"` å¸¶æœ‰ `data.phase`, `name`, å¯é¸ `meta`/`args`ã€‚
- æ¨™ç±¤:
  - `exec`: `args.command` çš„ç¬¬ä¸€è¡Œã€‚
  - `read`/`write`: ç¸®çŸ­çš„è·¯å¾‘ã€‚
  - `edit`: è·¯å¾‘åŠ ä¸Šå¾ `meta`/diff çµ±è¨ˆæ¨æ–·çš„è®Šæ›´ç¨®é¡ã€‚
  - fallback: å·¥å…·åç¨±ã€‚

## é™¤éŒ¯è¦†è“‹
- Settings â–¸ Debug â–¸ â€œIcon overrideâ€ é¸æ“‡å™¨:
  - `System (auto)` (é è¨­)
  - `Working: main` (ä¾å·¥å…·ç¨®é¡)
  - `Working: other` (ä¾å·¥å…·ç¨®é¡)
  - `Idle`
- é€é `@AppStorage("iconOverride")` å„²å­˜ï¼›å°æ‡‰è‡³ `IconState.overridden`ã€‚

## æ¸¬è©¦æª¢æŸ¥æ¸…å–®
- è§¸ç™¼ Main å·¥ä½œéšæ®µä½œæ¥­ï¼šé©—è­‰åœ–ç¤ºç«‹å³åˆ‡æ›ä¸”ç‹€æ…‹åˆ—é¡¯ç¤º Main æ¨™ç±¤ã€‚
- åœ¨ Main é–’ç½®æ™‚è§¸ç™¼é Main å·¥ä½œéšæ®µä½œæ¥­ï¼šåœ–ç¤º/ç‹€æ…‹é¡¯ç¤ºé Mainï¼›ä¿æŒç©©å®šç›´åˆ°å®Œæˆã€‚
- åœ¨å…¶ä»–ä½œæ¥­æ´»å‹•æ™‚å•Ÿå‹• Mainï¼šåœ–ç¤ºç¬é–“åˆ‡æ›è‡³ Mainã€‚
- å¿«é€Ÿå·¥å…·çˆ†ç™¼ï¼šç¢ºä¿å¾½ç« ä¸æœƒé–ƒçˆ (å·¥å…·çµæœæœ‰ TTL å¯¬é™æœŸ)ã€‚
- ä¸€æ—¦æ‰€æœ‰å·¥ä½œéšæ®µé–’ç½®ï¼Œå¥åº·åˆ—é‡æ–°å‡ºç¾ã€‚
